# https://github.com/DDDDD000/web-larek-frontend
# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с компонентом модальног окна
- src/model/ - папка с моделями данных
- src/presenter/ - папка с презентерами
- src/view/ - папка с представлениями

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

Карточка

```
export interface IProduct {
    id: string;
    title: string;
    image: string;
    category: string;
    price: number | null;
    description: string;
}
```

Пользователь

```
export interface IClient {
    payment: 'card' | 'cash' | '';
    address: string;
    email: string;
    phone: string;
}
```

Интерфейс для модели данных карточки

```
export interface ICatalogData {
    products: IMainPageCard[];
    preview: IProduct | null;
}
```

Интерфейс для модели данных корзины

```
export interface IBasketData {
    products: IBasketCard[]
}
```

Данные карточки, используемые для вывода на главной странице 

```
export type IMainPageCard = Pick<IProduct, 'id' | 'title' | 'image' | 'category' | 'price'>
```

Данные карточки, используемые для вывода в корзине

```
export type IBasketCard = Pick<IProduct, 'id' | 'title' | 'price'>
```

Данные пользователя, используемые для выполнения платежа

```
export type IPaymentInfo = Pick<IClient, 'payment' | 'address'>
```

Данные пользователя, используемые для заполнения контактных данных

```
export type IContacts = Pick<IClient, 'email' | "phone">
```

## Архитектура приложения 

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс API
Этот класс инкапсулирует базовую логику для выполнения HTTP-запросов. При создании экземпляра указывается базовый URL сервера и необязательные заголовки запросов.

Основные методы:

- `get` — отправляет `GET`-запрос на указанный эндпоинт и возвращает промис с ответом сервера в формате JSON.

- `post` — отправляет данные в формате JSON на указанный эндпоинт. По умолчанию используется метод `POST`, но можно переопределить его, передав третий параметр (например, PUT или DELETE).

Класс также включает обработку ответов:

В случае успешного запроса (response.ok === true) возвращается распарсенный JSON.

При ошибке серверного ответа (response.ok === false) промис отклоняется с текстом ошибки из ответа или стандартным описанием статуса.

#### Класс EventEmitter
Этот класс реализует паттерн «Наблюдатель» и служит централизованным механизмом для управления событиями в приложении. Он позволяет:

- Подписываться на события (on).
- Генерировать события (emit).
- Создавать триггеры — функции, которые при вызове инициируют событие (trigger).


##### Основные возможности
- `Гибкая подписка` — можно слушать события по строке или регулярному выражению.
- `Глобальные обработчики` — метод `onAll` позволяет подписаться на все события.
- `Контекст в триггерах` — метод `trigger` возвращает функцию, которая при вызове генерирует событие с возможностью передачи контекста.
- `Очистка подписок` — методы `off` и `offAll` для отмены подписки.

### Слой данных

#### Класс ProductModel
Класс отвечает за работу с данными товаров, получаемыми с сервера через API.

В полях класса хранятся следующие данные:

- api: Api — экземпляр класса Api для работы с HTTP-запросами.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- getProducts(): Promise<IProduct[]> — асинхронный метод, который отправляет GET-запрос на сервер по адресу /product и возвращает массив товаров IProduct[]. Если формат ответа не соответствует ожидаемому, выбрасывается ошибка.

- isCardsResponse(data: object): data is { total: number; items: IProduct[] } — приватный метод, проверяющий, что полученный ответ содержит поле items и что оно является массивом продуктов. Используется для валидации ответа от сервера.

#### Класс BasketModel
Класс отвечает за хранение и управление данными товаров в корзине покупателя.

В полях класса хранятся следующие данные:

- _products: IBasketCard[] — массив объектов товаров, добавленных в корзину.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- addProduct(product: IBasketCard): void — добавляет товар в корзину, если его там ещё нет. Если товар уже присутствует, выбрасывает ошибку.

- removeProduct(productId: string): void — удаляет товар из корзины по его идентификатору.

- getTotalPrice(): number — возвращает общую стоимость всех товаров в корзине.

- clearBasket(): void — очищает корзину, удаляя все товары.

Геттеры:

- products: IBasketCard[] — возвращает текущий массив товаров в корзине.

#### Класс CheckoutModel
Класс отвечает за хранение и управление данными клиента при оформлении заказа.

В полях класса хранятся следующие данные:

- client: IClient — объект с данными клиента, включающий поля оплаты, адреса, электронной почты и телефона.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- saveClientData(data: IClient): void — сохраняет данные клиента, обновляя текущие значения в объекте client.

- validateContacts(data: IContacts): boolean — проверяет корректность контактов клиента: валидность email и телефона по регулярным выражениям.

Геттеры:

- сlientData: IClient — возвращает текущие сохранённые данные клиента.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы open и close для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(container: HTMLElement, events: IEvents) — конструктор принимает контейнер модального окна и экземпляр класса EventEmitter для возможности инициации событий. В конструкторе устанавливаются обработчики событий на кнопку закрытия, клик по оверлею и предотвращается всплытие клика по содержимому.

Поля класса:

- container: HTMLElement — элемент контейнера модального окна

- events: IEvents — брокер событий, экземпляр EventEmitter для инициации событий

- _closeButton: HTMLButtonElement — кнопка закрытия модального окна

- _content: HTMLElement — контейнер для содержимого модального окна

Методы класса:
- set content(value: HTMLElement): void — заменяет содержимое модального окна на переданный элемент.

- open(): void — открывает модальное окно, добавляя активный класс.

- close(): void — закрывает модальное окно, удаляет содержимое и вызвает событие modal:close.

- render(data: IModalData): HTMLElement — рендерит содержимое, открывает окно и возвращает контейнер.

#### Класс ProductView
Отвечает за отображение товаров на странице и предварительный просмотр товара в отдельном блоке. В конструктор класса передаются шаблоны карточки и превью, а также экземпляр EventEmitter для генерации событий при взаимодействии с элементами.

В полях класса хранятся следующие данные:
- cardTemplate: HTMLTemplateElement — шаблон для создания карточки товара.

- previewTemplate: HTMLTemplateElement — шаблон для создания превью товара.

- events: EventEmitter — брокер событий для инициации пользовательских событий.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- createCard(product: IProduct): HTMLElement — создает DOM-элемент карточки товара на основе переданного объекта продукта. Устанавливает данные в элементы шаблона и добавляет обработчик клика, который инициирует событие открытия превью товара.

- showProductPreview(product: IProduct, isInBasket: boolean = false): HTMLElement — создает DOM-элемент превью товара. Заполняет элементы шаблона данными продукта и управляет состоянием кнопки добавления в корзину (отключена, если товар бесценен или уже в корзине). Добавляет обработчик на кнопку добавления в корзину, который инициирует событие добавления товара.

#### Класс BasketView
Отвечает за отображение корзины товаров на странице, управление списком товаров, общей стоимостью и состоянием кнопки оформления заказа. В конструктор класса передается контейнер с элементами корзины и экземпляр EventEmitter для инициации событий.

В полях класса хранятся следующие данные:

- _container: HTMLElement — корневой элемент корзины.

- _list: HTMLElement — элемент списка товаров в корзине.

- _priceEl: HTMLElement — элемент для отображения общей стоимости товаров.

- _orderButton: HTMLButtonElement — кнопка оформления заказа.

- events: EventEmitter — брокер событий для генерации пользовательских событий.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- render(items: HTMLElement[]): void — отображает переданный массив элементов товаров в списке корзины.

- setTotalPrice(value: number): void — обновляет отображение общей стоимости товаров в корзине.

- setOrderButtonState(enabled: boolean): void — включает или отключает кнопку оформления заказа.

- onOrderClick(cb: () => void): void — устанавливает обработчик клика на кнопку оформления заказа.

Геттеры:
- container: HTMLElement — возвращает корневой элемент корзины.

#### Класс CheckoutView
Отвечает за отображение форм оформления заказа и контактов, а также управление взаимодействием с этими формами. В конструктор класса передаются контейнер для отображения и экземпляр EventEmitter для генерации событий при взаимодействии пользователя.

В полях класса хранятся следующие данные:

- _container: HTMLElement — корневой элемент контейнера для форм.

- _checkoutOrderTemplate: HTMLTemplateElement — шаблон формы оформления заказа.

- _contactTemplate: HTMLTemplateElement — шаблон формы контактов.

- _formElement: HTMLFormElement — текущий отображаемый элемент формы.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- renderOrderForm(): void — отображает форму оформления заказа, устанавливает обработчики выбора способа оплаты, ввода адреса и сабмита формы. Инициирует события с текущими данными.

- setOrderNextEnabled(enabled: boolean): void — включает или отключает кнопку продолжения оформления заказа.

- renderContactForm(): void — отображает форму ввода контактных данных, устанавливает обработчики ввода email и телефона, а также сабмита формы. Инициирует события с текущими контактными данными.

- setContactSubmitEnabled(enabled: boolean): void — включает или отключает кнопку отправки контактной информации.

#### Класс HeaderView
Отвечает за отображение и взаимодействие с элементами шапки сайта, в частности кнопкой корзины.

В полях класса хранятся следующие данные:

- _basketButton: HTMLButtonElement — кнопка открытия корзины.

- events: EventEmitter — брокер событий для генерации пользовательских событий.

#### Класс FinalMessageView
Отвечает за отображение сообщения об успешном завершении заказа с информацией о списанной сумме.

В полях класса хранятся следующие данные:

- container: HTMLElement — контейнер для отображения сообщения.

- template: HTMLTemplateElement — шаблон сообщения об успехе.

- events: IEvents — брокер событий для инициации пользовательских событий.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- render(data: IFinal): HTMLElement — создает DOM-элемент сообщения, заполняет его данными о списанной сумме и устанавливает обработчик клика на кнопку закрытия, который инициирует событие закрытия сообщения. Возвращает сформированный элемент.

#### Класс MainPageView
Отвечает за отображение главной страницы, включая галерею товаров и элементы управления корзиной.

В полях класса хранятся следующие данные:

- container: HTMLElement — корневой контейнер главной страницы.

- gallery: HTMLElement — элемент галереи товаров.

- basketButton: HTMLElement — кнопка открытия корзины в шапке сайта.

- basketCounter: HTMLElement — элемент счётчика количества товаров в корзине.

- events: EventEmitter — брокер событий для генерации пользовательских событий.

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- render(cards: HTMLElement[]): void — отображает переданный массив карточек товаров в галерее.

- setCounter(count: number): void — обновляет значение счётчика товаров в корзине.

### Слой коммуникации

#### Класс OrderApi
Расширяет класс Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

Код, описывающий взаимодействие представления и данных между собой находится в файлах `ProductPresenter`, `BasketPresenter` и `CheckoutPresenter` выполняющих роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий

### *События изменения данных (генерируются моделями и презентерами)*
- basket:add — добавить товар в корзину.

- basket:remove — удалить товар из корзины.

- basket:changed — содержимое корзины изменилось.

### *События взаимодействия с интерфейсом (генерируются видами и презентерами)*
- product:open — открыть подробный просмотр товара.

- checkout:order:input — изменение данных формы оформления заказа.

- checkout:order:submit — отправка формы оформления заказа.

- checkout:contacts:input — изменение данных контактной формы.

- checkout:submit — отправка контактных данных.

- success:close — закрытие окна успешного завершения заказа.

- basket:open — открыть корзину (по кнопке в шапке).

- modal:close — закрыть модальное окно.